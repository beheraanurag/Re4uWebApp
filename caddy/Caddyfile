# Reverse proxy on port 80 (set PROXY_HOST in .env for name-based routing in production)
# Routes: /directus/* -> Directus, everything else -> Next.js (host)
# Listen on :80 so localhost and 127.0.0.1 both work
:80 {
  # Directus at /directus (path stripped when forwarding)
  handle /directus {
    redir /directus/ permanent
  }
  handle_path /directus/* {
    reverse_proxy directus:8055
  }

  # Next.js app (run with npm run dev; uses host.docker.internal)
  handle {
    reverse_proxy host.docker.internal:3000
  }
}
